# Тестовое задание по прогнозированию поломки мотора

## Постановка задачи

Необходимо предложить решение задачи прогнозирования отказа моторов на основании показаний измерений датчиков  и варианты использования этого решения на практике.

Описание данных (архив во вложении):

- id -- идентификатор мотора
- cycle -- цикл работы
- p00-p20 -- показания датчиков считываемые в процессе работы
- s0, s1 -- настройки изменяемые в конце каждого цикла

Доп. задание: предложить альтернативную постановку задачи прогноза отказа моторов.

## Предложенное решение

В качестве возможного решения предлагается использовать модель предсказания числа рабоичх циклов до отказа (cycles_to_failure).

Была выбрана модель градиентного бустинга `CatBoostRegressor` от Яндекса, которая показала следующие результаты:

|  | Train | Test |
| --- | --- | --- |
| RMSE | 32.05 | 31.88 |
| R2 | 0.72 | 0.68 |

Код предложенного решения вместе с описанием хода размышлений распределен в нескольких файлах:

- eda.ipynb — блокнот, в котором осуществлен предварительный анализ данных и поиск дополнительных свойств (аттрибутов) данных
- model.ipynb — блокнот, в котором осущствляется предобработка данных, поиск наилучшей модели среди определенного множества на основании кросс-валидации на тренировочной выборке, подбор параметров для наилучшей модели и её тестирование
- utils.py — файл с небольшими вспомогательными функциями
- custom_transformers.py -- пользовательский обработчик данных

### Замечания по предложенному решению

1. Для верной интерпретации результата и принятия решения о дальнейшей доработки модели (или поиска лучшего решения) необходимо уточнить у заказчика, который эксплуатирует данные моторы (машины, станки), сколько времени занимает один рабочий цикл мотора, каким явлется оптимальное время для своевременной подготовки к переналадке и/или обслуживанию оборудования.  От того, сколько времени занимает сам процесс переналадки/ремонта оборудования и сколько времени нужно для того, чтобы подготовить ресурсы для предотвращения поломки (поиск запчастей, выделенее рабочего времени специалиста и т.п.) зависит допустимый временной интервал, который задает модель предсказания.
 И тем не менее, полученное значение почти в два раза меньше стандартного отклонения от среднего значения числа циклов до отказа. 
2. Представленные выше результаты были получены в результате обучения на выборке с исключенным номером мотора (id). Однако если его не исключать, модели градиентного бустинга достигают гораздо более точных результатов (RMSE варьируется от 4 до 6). 
Отсюда можно предположить, что эти модели начинают “учитывать” динамику процесса для конкретного мотора. Скорее всего, происходит переобучение за счет того, что модель выдвигает решение на основании номера конкретного мотора. Это подвержается путем небольшого эксперимента с разделением исходной выборки на тестовую и обучающие ( в конце файла model.ipynb).
Здравый смысл подсказывает, что модель должна быть независима от идентификатора мотора, но, возможно, в данной задаче число моторов не изменится? моторы не будут заменены и также допускается возможность анализа результатов продолжительных измерений для одних и тех же моторов. Это должно быть уточнено с заказчиком и проверено в дальнейших исследованиях.

## Применение предложенного решения на практике

Исходя из постановки задачи, можно предположить, что речь идет о каком-то промышленном произведстве (где моторами выступают станки или другое специализированное оборудование), или же это мониторинг состояния двигателей транспортных средств (таксопарк, компания перевозчик и т.п).

И в том, и в другом случае наиболее логчиным решением представляется задействовать типичную архитектуру решения для IoT Monitoring


У каждого мотора есть несколько сенсоров, которые взаимодействует с выделенным шлюзом по одному из возможных протоколов (zigbee, bluetooth, zwave и др.) Сенсоры измеряют определенные показатели и сохраняют их, после чего передают на шлюз. Шлюз затем отправляет эти данные на облачный сервер, где происходит обработка данных для предсказания возможной поломки. 

Существуют популярные решения для развертывания моделей машинного и глубокого обучения на облачных платформах (Google Cloud, AWS, Microsoft Azure). [Есть отдельная документация по тому, как подключить CatBoost в YandexCloud.](https://cloud.yandex.ru/docs/managed-clickhouse/operations/ml-models)

*Схема архитектуры решения развертывание модели с помощью Microsoft Azure.*

## Альтернативная постановка задачи

Данную задачу можно представить как задачу классификации. Нам известно, что каждый последний цикл для мотора явлется последним перед поломкой. Далее уточняется от заказчика, какое число рабочих циклов до отказа является приемлемых временем для своевременной подготовки к обслуживанию/переналадки оборудования. И тогда можно разметить данные следующим образом:

| id | p00-p20 | s1-s2 | close_to_failure |
| --- | --- | --- | --- |
| 1 | .. | .. | 0 |
| 1 | .. | .. | 0 |
| 1 | .. | .. | 0 |
| 1 | .. | .. | 0 |
| ... | .. | .. | ... |
| 1 | .. | .. | 1 |
| 1 | .. | .. | 1 |
| 2 | .. | .. | 0 |
| ... | .. | .. |  |

Здесь колонка failure содержит значение, кодирующуе состояние (класс) потора: 0 — нормальное состояние, 1 — близкое к поломке.

Так показания датчиков являются разнородными данными, целесообразно попробовать применить модели градиентного бустинга для задач классификации.